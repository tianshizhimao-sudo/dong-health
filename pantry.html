<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1a2e">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ </text></svg>">
  <title>ğŸ  å®¶åº­é£Ÿæåº“å­˜</title>
  <style>
    :root {
      --bg: #1a1a2e;
      --card: #16213e;
      --accent: #f59e0b;
      --accent-light: #fbbf24;
      --text: #eaeaea;
      --muted: #a0a0a0;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border: #0f3460;
      --input-bg: #0f1729;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      padding-bottom: 160px;
    }
    .container { max-width: 500px; margin: 0 auto; }
    
    header { text-align: center; padding: 16px 0 20px; }
    h1 { font-size: 24px; margin-bottom: 4px; }
    .subtitle { color: var(--muted); font-size: 13px; }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }
    .tab {
      padding: 10px 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      flex-shrink: 0;
    }
    .tab.active { background: var(--accent); border-color: var(--accent); color: #1a1a2e; }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Cards */
    .section {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
    }
    .section-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--accent-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .section-badge {
      font-size: 11px;
      padding: 4px 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      color: var(--muted);
      font-weight: 500;
    }
    
    /* Item List */
    .item-list { display: flex; flex-direction: column; gap: 8px; }
    
    .item {
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.2s;
    }
    .item.expiring-soon {
      border-color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }
    .item.expired {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    .item.low-stock {
      border-color: var(--danger);
    }
    
    .item-icon {
      font-size: 24px;
      width: 40px;
      text-align: center;
    }
    .item-info { flex: 1; min-width: 0; }
    .item-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .item-meta .location { color: #60a5fa; }
    .item-meta .expiry { color: var(--warning); }
    .item-meta .expiry.expired { color: var(--danger); }
    
    .item-qty {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .qty-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .qty-btn:hover { border-color: var(--accent); }
    .qty-btn.minus { color: var(--danger); }
    .qty-btn.plus { color: var(--success); }
    .qty-value {
      font-size: 16px;
      font-weight: 700;
      min-width: 30px;
      text-align: center;
    }
    
    /* Add Item Form */
    .add-form {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    .form-group { flex: 1; }
    .form-group.small { flex: 0 0 80px; }
    .form-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }
    .form-input, .form-select {
      width: 100%;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      -webkit-appearance: none;
    }
    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .btn-primary {
      background: var(--accent);
      color: #1a1a2e;
      width: 100%;
    }
    .btn-primary:hover { background: var(--accent-light); }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    /* History */
    .history-item {
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-item:last-child { border-bottom: none; }
    .history-action {
      font-size: 13px;
    }
    .history-action.in { color: var(--success); }
    .history-action.out { color: var(--danger); }
    .history-date {
      font-size: 11px;
      color: var(--muted);
    }
    
    /* Alerts */
    .alert-card {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(245, 158, 11, 0.15));
      border: 1px solid var(--warning);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .alert-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .alert-list {
      font-size: 13px;
      color: var(--text);
      line-height: 1.6;
    }
    
    /* Recipe Suggestion */
    .recipe-card {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(59, 130, 246, 0.15));
      border: 1px solid var(--success);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .recipe-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .recipe-ingredients {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    .recipe-actions {
      display: flex;
      gap: 10px;
    }
    .recipe-actions .btn { flex: 1; padding: 10px; }
    
    /* Shopping List */
    .shopping-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .shopping-item:last-child { border-bottom: none; }
    .shopping-check {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 2px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .shopping-check.checked {
      background: var(--success);
      border-color: var(--success);
    }
    .shopping-check.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 14px;
    }
    .shopping-text {
      flex: 1;
      font-size: 14px;
    }
    .shopping-text.checked {
      text-decoration: line-through;
      color: var(--muted);
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    .empty-state .emoji { font-size: 48px; margin-bottom: 12px; }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--success);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 14px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      width: 100%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .modal-actions .btn { flex: 1; }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .stat-card {
      background: var(--card);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ  å®¶åº­é£Ÿæåº“å­˜</h1>
      <p class="subtitle">Dong & Olivia çš„é£Ÿæç®¡ç†</p>
    </header>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalItems">0</div>
        <div class="stat-label">é£Ÿæç§ç±»</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="expiringCount">0</div>
        <div class="stat-label">å³å°†è¿‡æœŸ</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="lowStockCount">0</div>
        <div class="stat-label">éœ€è¡¥è´§</div>
      </div>
    </div>

    <!-- Alerts -->
    <div id="alertsSection" class="alert-card" style="display: none;">
      <div class="alert-title">âš ï¸ éœ€è¦æ³¨æ„</div>
      <div class="alert-list" id="alertsList"></div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('inventory')">ğŸ“¦ åº“å­˜</button>
      <button class="tab" onclick="showTab('add')">â• å…¥åº“</button>
      <button class="tab" onclick="showTab('suggest')">ğŸ³ ä»Šå¤©åƒå•¥</button>
      <button class="tab" onclick="showTab('shopping')">ğŸ›’ é‡‡ä¹°</button>
      <button class="tab" onclick="showTab('history')">ğŸ“Š è®°å½•</button>
    </div>

    <!-- Inventory Tab -->
    <div id="inventory" class="tab-content active">
      <div class="section">
        <div class="section-title">
          <span>ğŸ¥¬ ç”Ÿé²œè”¬æœ</span>
          <span class="section-badge" id="freshCount">0</span>
        </div>
        <div class="item-list" id="freshList"></div>
      </div>

      <div class="section">
        <div class="section-title">
          <span>ğŸ¥© è‚‰ç±»æµ·é²œ</span>
          <span class="section-badge" id="meatCount">0</span>
        </div>
        <div class="item-list" id="meatList"></div>
      </div>

      <div class="section">
        <div class="section-title">
          <span>ğŸ¥› ä¹³åˆ¶å“è›‹ç±»</span>
          <span class="section-badge" id="dairyCount">0</span>
        </div>
        <div class="item-list" id="dairyList"></div>
      </div>

      <div class="section">
        <div class="section-title">
          <span>ğŸš ä¸»é£Ÿå¹²è´§</span>
          <span class="section-badge" id="stapleCount">0</span>
        </div>
        <div class="item-list" id="stapleList"></div>
      </div>

      <div class="section">
        <div class="section-title">
          <span>ğŸ§‚ è°ƒæ–™é…æ–™</span>
          <span class="section-badge" id="condimentCount">0</span>
        </div>
        <div class="item-list" id="condimentList"></div>
      </div>

      <div class="section">
        <div class="section-title">
          <span>ğŸ¥œ åšæœé›¶é£Ÿ</span>
          <span class="section-badge" id="snackCount">0</span>
        </div>
        <div class="item-list" id="snackList"></div>
      </div>
    </div>

    <!-- Add Tab -->
    <div id="add" class="tab-content">
      <div class="add-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">é£Ÿæåç§°</label>
            <input type="text" class="form-input" id="itemName" placeholder="ä¾‹å¦‚ï¼šè¥¿å…°èŠ±">
          </div>
          <div class="form-group small">
            <label class="form-label">æ•°é‡</label>
            <input type="number" class="form-input" id="itemQty" value="1" min="1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">åˆ†ç±»</label>
            <select class="form-select" id="itemCategory">
              <option value="fresh">ğŸ¥¬ ç”Ÿé²œè”¬æœ</option>
              <option value="meat">ğŸ¥© è‚‰ç±»æµ·é²œ</option>
              <option value="dairy">ğŸ¥› ä¹³åˆ¶å“è›‹ç±»</option>
              <option value="staple">ğŸš ä¸»é£Ÿå¹²è´§</option>
              <option value="condiment">ğŸ§‚ è°ƒæ–™é…æ–™</option>
              <option value="snack">ğŸ¥œ åšæœé›¶é£Ÿ</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">å•ä½</label>
            <select class="form-select" id="itemUnit">
              <option value="ä¸ª">ä¸ª</option>
              <option value="åŒ…">åŒ…</option>
              <option value="ç›’">ç›’</option>
              <option value="ç“¶">ç“¶</option>
              <option value="è¢‹">è¢‹</option>
              <option value="g">å…‹(g)</option>
              <option value="kg">å…¬æ–¤(kg)</option>
              <option value="L">å‡(L)</option>
              <option value="æŠŠ">æŠŠ</option>
              <option value="é¢—">é¢—</option>
              <option value="æ ¹">æ ¹</option>
              <option value="åª">åª</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">å­˜æ”¾ä½ç½®</label>
            <select class="form-select" id="itemLocation">
              <option value="å†°ç®±ä¿é²œ">ğŸ§Š å†°ç®±ä¿é²œ</option>
              <option value="å†°ç®±å†·å†»">â„ï¸ å†°ç®±å†·å†»</option>
              <option value="å¨æˆ¿æŸœ1">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰1</option>
              <option value="å¨æˆ¿æŸœ2">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰2</option>
              <option value="å¨æˆ¿æŸœ3">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰3</option>
              <option value="å¨æˆ¿æŸœ4">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰4</option>
              <option value="çƒ¤ç®±å·¦">ğŸ“ çƒ¤ç®±å·¦</option>
              <option value="çƒ¤ç®±å³">ğŸ“ çƒ¤ç®±å³</option>
              <option value="æ“ä½œå°ä¸‹">ğŸ“ æ“ä½œå°ä¸‹</option>
              <option value="å…¶ä»–">ğŸ“ å…¶ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">è¿‡æœŸæ—¥æœŸ (å¯é€‰)</label>
            <input type="date" class="form-input" id="itemExpiry">
          </div>
        </div>
        <button class="btn btn-primary" onclick="addItem()">â• æ·»åŠ åˆ°åº“å­˜</button>
      </div>

      <div class="section">
        <div class="section-title">âš¡ å¿«é€Ÿæ·»åŠ </div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
          <button class="btn btn-secondary" onclick="quickAdd('é¸¡è›‹', 'dairy', '12', 'ä¸ª', 'å†°ç®±ä¿é²œ')">ğŸ¥š é¸¡è›‹</button>
          <button class="btn btn-secondary" onclick="quickAdd('ç‰›å¥¶', 'dairy', '1', 'L', 'å†°ç®±ä¿é²œ')">ğŸ¥› ç‰›å¥¶</button>
          <button class="btn btn-secondary" onclick="quickAdd('è¥¿å…°èŠ±', 'fresh', '1', 'é¢—', 'å†°ç®±ä¿é²œ')">ğŸ¥¦ è¥¿å…°èŠ±</button>
          <button class="btn btn-secondary" onclick="quickAdd('é¸¡èƒ¸è‚‰', 'meat', '500', 'g', 'å†°ç®±å†·å†»')">ğŸ— é¸¡èƒ¸è‚‰</button>
          <button class="btn btn-secondary" onclick="quickAdd('ä¸‰æ–‡é±¼', 'meat', '400', 'g', 'å†°ç®±å†·å†»')">ğŸŸ ä¸‰æ–‡é±¼</button>
          <button class="btn btn-secondary" onclick="quickAdd('å¤§ç±³', 'staple', '2', 'kg', 'å¨æˆ¿æŸœ1')">ğŸš å¤§ç±³</button>
          <button class="btn btn-secondary" onclick="quickAdd('é¦™è•‰', 'fresh', '1', 'æŠŠ', 'å…¶ä»–')">ğŸŒ é¦™è•‰</button>
          <button class="btn btn-secondary" onclick="quickAdd('ç•ªèŒ„', 'fresh', '4', 'ä¸ª', 'å†°ç®±ä¿é²œ')">ğŸ… ç•ªèŒ„</button>
        </div>
      </div>
    </div>

    <!-- Suggest Tab -->
    <div id="suggest" class="tab-content">
      <div class="recipe-card" id="recipeCard">
        <div class="recipe-title">ğŸ³ æ­£åœ¨åˆ†æåº“å­˜...</div>
        <div class="recipe-ingredients">æ ¹æ®ç°æœ‰é£Ÿææ¨èèœå“</div>
      </div>

      <button class="btn btn-primary" onclick="generateSuggestion()" style="margin-bottom: 16px;">ğŸ”„ æ¢ä¸€ä¸ªæ¨è</button>

      <div class="section">
        <div class="section-title">ğŸ“‹ ç°æœ‰ä¸»è¦é£Ÿæ</div>
        <div id="availableIngredients" class="item-list"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ”— å¿«é€Ÿå…¥å£</div>
        <a href="olivia-food-picker/index.html" class="btn btn-secondary" style="width: 100%; margin-bottom: 10px; text-decoration: none;">
          ğŸ² Olivia ä»Šå¤©åƒä»€ä¹ˆ
        </a>
      </div>
    </div>

    <!-- Shopping Tab -->
    <div id="shopping" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ›’ éœ€è¦è¡¥è´§</span>
          <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="clearShoppingList()">æ¸…ç©º</button>
        </div>
        <div id="shoppingList"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ“… äºŒæœˆé‡‡ä¹°è®¡åˆ’</div>
        <div style="font-size: 13px; color: var(--muted); line-height: 1.6;">
          <p><strong>æ¯å‘¨å›ºå®šï¼š</strong>ä¸‰æ–‡é±¼ã€é¸¡èƒ¸è‚‰ã€é¸¡è›‹ã€è±†è…ã€å¸Œè…Šé…¸å¥¶</p>
          <p style="margin-top: 8px;"><strong>ç”Ÿé²œ(2-3æ¬¡)ï¼š</strong>è¥¿å…°èŠ±ã€è èœã€ç•ªèŒ„ã€é»„ç“œã€é¦™è•‰ã€è“è“</p>
          <p style="margin-top: 8px;"><strong>æœˆåˆï¼š</strong>å¤§ç±³ã€ç‡•éº¦ã€åšæœã€èœ‚èœœã€æ©„æ¦„æ²¹</p>
        </div>
        <a href="february-shopping-list.md" class="btn btn-secondary" style="width: 100%; margin-top: 12px; text-decoration: none;">
          ğŸ“‹ æŸ¥çœ‹å®Œæ•´é‡‡ä¹°è®¡åˆ’
        </a>
      </div>
    </div>

    <!-- History Tab -->
    <div id="history" class="tab-content">
      <div class="section">
        <div class="section-title">
          <span>ğŸ“Š å‡ºå…¥åº“è®°å½•</span>
          <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="clearHistory()">æ¸…ç©º</button>
        </div>
        <div id="historyList"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ’¾ æ•°æ®ç®¡ç†</div>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-secondary" style="flex: 1;" onclick="exportData()">ğŸ“¤ å¯¼å‡º</button>
          <button class="btn btn-secondary" style="flex: 1;" onclick="importDataClick()">ğŸ“¥ å¯¼å…¥</button>
        </div>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-title">âœï¸ ç¼–è¾‘é£Ÿæ</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">åç§°</label>
          <input type="text" class="form-input" id="editName">
        </div>
        <div class="form-group small">
          <label class="form-label">æ•°é‡</label>
          <input type="number" class="form-input" id="editQty" min="0">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ä½ç½®</label>
          <select class="form-select" id="editLocation">
            <option value="å†°ç®±ä¿é²œ">ğŸ§Š å†°ç®±ä¿é²œ</option>
            <option value="å†°ç®±å†·å†»">â„ï¸ å†°ç®±å†·å†»</option>
            <option value="å¨æˆ¿æŸœ1">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰1</option>
            <option value="å¨æˆ¿æŸœ2">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰2</option>
            <option value="å¨æˆ¿æŸœ3">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰3</option>
            <option value="å¨æˆ¿æŸœ4">ğŸ—„ï¸ å¨æˆ¿æŸœ-æŠ½å±‰4</option>
            <option value="çƒ¤ç®±å·¦">ğŸ“ çƒ¤ç®±å·¦</option>
            <option value="çƒ¤ç®±å³">ğŸ“ çƒ¤ç®±å³</option>
            <option value="æ“ä½œå°ä¸‹">ğŸ“ æ“ä½œå°ä¸‹</option>
            <option value="å…¶ä»–">ğŸ“ å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">è¿‡æœŸæ—¥æœŸ</label>
          <input type="date" class="form-input" id="editExpiry">
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" onclick="deleteItem()">ğŸ—‘ï¸ åˆ é™¤</button>
        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="saveEdit()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // å®¶åº­é£Ÿæåº“å­˜ç®¡ç†ç³»ç»Ÿ
    // ============================================

    let inventory = [];
    let history = [];
    let shoppingList = [];
    let editingId = null;

    const categoryIcons = {
      fresh: 'ğŸ¥¬',
      meat: 'ğŸ¥©',
      dairy: 'ğŸ¥›',
      staple: 'ğŸš',
      condiment: 'ğŸ§‚',
      snack: 'ğŸ¥œ'
    };

    const categoryNames = {
      fresh: 'ç”Ÿé²œè”¬æœ',
      meat: 'è‚‰ç±»æµ·é²œ',
      dairy: 'ä¹³åˆ¶å“è›‹ç±»',
      staple: 'ä¸»é£Ÿå¹²è´§',
      condiment: 'è°ƒæ–™é…æ–™',
      snack: 'åšæœé›¶é£Ÿ'
    };

    // èœå“æ¨èæ•°æ®
    const recipes = [
      { name: 'ç•ªèŒ„ç‚’è›‹', ingredients: ['ç•ªèŒ„', 'é¸¡è›‹'], need: ['è‘±'] },
      { name: 'è¥¿å…°èŠ±ç‚’é¸¡èƒ¸', ingredients: ['è¥¿å…°èŠ±', 'é¸¡èƒ¸è‚‰'], need: ['è’œ'] },
      { name: 'ä¸‰æ–‡é±¼é…è”¬èœ', ingredients: ['ä¸‰æ–‡é±¼', 'è¥¿å…°èŠ±', 'èƒ¡èåœ'], need: ['æŸ æª¬'] },
      { name: 'è’œè“‰è èœ', ingredients: ['è èœ', 'å¤§è’œ'], need: [] },
      { name: 'é»„ç“œæ‹Œè±†è…', ingredients: ['é»„ç“œ', 'è±†è…'], need: ['é¦™æ²¹'] },
      { name: 'ç‰›æ²¹æœåå¸', ingredients: ['ç‰›æ²¹æœ', 'å…¨éº¦é¢åŒ…', 'é¸¡è›‹'], need: [] },
      { name: 'è™¾ä»ç‚’è›‹', ingredients: ['è™¾ä»', 'é¸¡è›‹'], need: ['è‘±'] },
      { name: 'è”¬èœæ„é¢', ingredients: ['æ„é¢', 'ç•ªèŒ„', 'å½©æ¤’'], need: ['æ©„æ¦„æ²¹'] },
      { name: 'é…¸å¥¶æ°´æœç¢—', ingredients: ['å¸Œè…Šé…¸å¥¶', 'è“è“', 'é¦™è•‰', 'åšæœ'], need: ['èœ‚èœœ'] },
      { name: 'é¸¡è‚‰æ²™æ‹‰', ingredients: ['é¸¡èƒ¸è‚‰', 'ç”Ÿèœ', 'ç•ªèŒ„', 'é»„ç“œ'], need: ['æ²™æ‹‰é…±'] },
      { name: 'ç‡•éº¦ç²¥', ingredients: ['ç‡•éº¦', 'ç‰›å¥¶', 'è“è“'], need: ['èœ‚èœœ'] },
      { name: 'ç´«è–¯ç²¥', ingredients: ['ç´«è–¯', 'å°ç±³'], need: [] },
      { name: 'å—ç“œè’¸è›‹', ingredients: ['å—ç“œ', 'é¸¡è›‹'], need: [] },
      { name: 'è’œé¦™è™¾', ingredients: ['è™¾ä»', 'å¤§è’œ'], need: ['é»„æ²¹'] }
    ];

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      renderAll();
    });

    // ============================================
    // æ•°æ®æ“ä½œ
    // ============================================

    function loadData() {
      const saved = localStorage.getItem('pantry-inventory');
      if (saved) inventory = JSON.parse(saved);
      
      const savedHistory = localStorage.getItem('pantry-history');
      if (savedHistory) history = JSON.parse(savedHistory);
      
      const savedShopping = localStorage.getItem('pantry-shopping');
      if (savedShopping) shoppingList = JSON.parse(savedShopping);
    }

    function saveData() {
      localStorage.setItem('pantry-inventory', JSON.stringify(inventory));
      localStorage.setItem('pantry-history', JSON.stringify(history));
      localStorage.setItem('pantry-shopping', JSON.stringify(shoppingList));
    }

    function addItem() {
      const name = document.getElementById('itemName').value.trim();
      const qty = parseInt(document.getElementById('itemQty').value) || 1;
      const category = document.getElementById('itemCategory').value;
      const unit = document.getElementById('itemUnit').value;
      const location = document.getElementById('itemLocation').value;
      const expiry = document.getElementById('itemExpiry').value;

      if (!name) {
        showToast('è¯·è¾“å…¥é£Ÿæåç§°', 'warning');
        return;
      }

      const item = {
        id: Date.now(),
        name,
        qty,
        category,
        unit,
        location,
        expiry: expiry || null,
        addedAt: new Date().toISOString()
      };

      inventory.push(item);
      addHistory('in', name, qty, unit);
      saveData();
      renderAll();

      // æ¸…ç©ºè¡¨å•
      document.getElementById('itemName').value = '';
      document.getElementById('itemQty').value = '1';
      document.getElementById('itemExpiry').value = '';

      showToast(`å·²æ·»åŠ  ${name}`);
      showTab('inventory');
    }

    function quickAdd(name, category, qty, unit, location) {
      const item = {
        id: Date.now(),
        name,
        qty: parseInt(qty),
        category,
        unit,
        location,
        expiry: null,
        addedAt: new Date().toISOString()
      };

      inventory.push(item);
      addHistory('in', name, qty, unit);
      saveData();
      renderAll();
      showToast(`å·²æ·»åŠ  ${name}`);
    }

    function updateQty(id, delta) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;

      item.qty += delta;
      
      if (item.qty <= 0) {
        inventory = inventory.filter(i => i.id !== id);
        addHistory('out', item.name, Math.abs(delta), item.unit);
        
        // æ·»åŠ åˆ°è´­ç‰©æ¸…å•
        if (!shoppingList.includes(item.name)) {
          shoppingList.push(item.name);
        }
      } else {
        addHistory(delta > 0 ? 'in' : 'out', item.name, Math.abs(delta), item.unit);
      }

      saveData();
      renderAll();
    }

    function addHistory(action, name, qty, unit) {
      history.unshift({
        action,
        name,
        qty,
        unit,
        date: new Date().toISOString()
      });
      
      // åªä¿ç•™æœ€è¿‘100æ¡
      if (history.length > 100) history = history.slice(0, 100);
    }

    function openEdit(id) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;

      editingId = id;
      document.getElementById('editName').value = item.name;
      document.getElementById('editQty').value = item.qty;
      document.getElementById('editLocation').value = item.location;
      document.getElementById('editExpiry').value = item.expiry || '';
      
      document.getElementById('editModal').classList.add('show');
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('show');
      editingId = null;
    }

    function saveEdit() {
      const item = inventory.find(i => i.id === editingId);
      if (!item) return;

      item.name = document.getElementById('editName').value.trim();
      item.qty = parseInt(document.getElementById('editQty').value) || 0;
      item.location = document.getElementById('editLocation').value;
      item.expiry = document.getElementById('editExpiry').value || null;

      if (item.qty <= 0) {
        inventory = inventory.filter(i => i.id !== editingId);
      }

      saveData();
      renderAll();
      closeModal();
      showToast('å·²ä¿å­˜');
    }

    function deleteItem() {
      const item = inventory.find(i => i.id === editingId);
      if (!item) return;

      inventory = inventory.filter(i => i.id !== editingId);
      addHistory('out', item.name, item.qty, item.unit);
      
      if (!shoppingList.includes(item.name)) {
        shoppingList.push(item.name);
      }

      saveData();
      renderAll();
      closeModal();
      showToast('å·²åˆ é™¤');
    }

    // ============================================
    // æ¸²æŸ“
    // ============================================

    function renderAll() {
      renderInventory();
      renderStats();
      renderAlerts();
      renderHistory();
      renderShopping();
      renderSuggestion();
    }

    function renderInventory() {
      const categories = ['fresh', 'meat', 'dairy', 'staple', 'condiment', 'snack'];
      
      categories.forEach(cat => {
        const items = inventory.filter(i => i.category === cat);
        const list = document.getElementById(`${cat}List`);
        const count = document.getElementById(`${cat}Count`);
        
        count.textContent = items.length;
        
        if (items.length === 0) {
          list.innerHTML = '<div class="empty-state"><p style="font-size: 13px;">æš‚æ— é£Ÿæ</p></div>';
          return;
        }

        list.innerHTML = items.map(item => {
          const expiryClass = getExpiryClass(item.expiry);
          const expiryText = getExpiryText(item.expiry);
          
          return `
            <div class="item ${expiryClass}" onclick="openEdit(${item.id})">
              <div class="item-icon">${getItemIcon(item.name)}</div>
              <div class="item-info">
                <div class="item-name">${item.name}</div>
                <div class="item-meta">
                  <span class="location">ğŸ“ ${item.location}</span>
                  ${expiryText ? `<span class="expiry ${expiryClass}">${expiryText}</span>` : ''}
                </div>
              </div>
              <div class="item-qty">
                <button class="qty-btn minus" onclick="event.stopPropagation(); updateQty(${item.id}, -1)">âˆ’</button>
                <span class="qty-value">${item.qty}${item.unit}</span>
                <button class="qty-btn plus" onclick="event.stopPropagation(); updateQty(${item.id}, 1)">+</button>
              </div>
            </div>
          `;
        }).join('');
      });
    }

    function renderStats() {
      document.getElementById('totalItems').textContent = inventory.length;
      
      const expiring = inventory.filter(i => {
        if (!i.expiry) return false;
        const days = getDaysUntilExpiry(i.expiry);
        return days >= 0 && days <= 3;
      });
      document.getElementById('expiringCount').textContent = expiring.length;
      
      document.getElementById('lowStockCount').textContent = shoppingList.length;
    }

    function renderAlerts() {
      const alerts = [];
      
      // è¿‡æœŸ/å³å°†è¿‡æœŸ
      inventory.forEach(item => {
        if (!item.expiry) return;
        const days = getDaysUntilExpiry(item.expiry);
        if (days < 0) {
          alerts.push(`âŒ <strong>${item.name}</strong> å·²è¿‡æœŸ`);
        } else if (days === 0) {
          alerts.push(`âš ï¸ <strong>${item.name}</strong> ä»Šå¤©è¿‡æœŸ`);
        } else if (days <= 3) {
          alerts.push(`â° <strong>${item.name}</strong> ${days}å¤©åè¿‡æœŸ`);
        }
      });

      const section = document.getElementById('alertsSection');
      if (alerts.length > 0) {
        document.getElementById('alertsList').innerHTML = alerts.join('<br>');
        section.style.display = 'block';
      } else {
        section.style.display = 'none';
      }
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      
      if (history.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ“Š</div><p>æš‚æ— è®°å½•</p></div>';
        return;
      }

      list.innerHTML = history.slice(0, 20).map(h => {
        const date = new Date(h.date);
        const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
        return `
          <div class="history-item">
            <span class="history-action ${h.action}">${h.action === 'in' ? 'ğŸ“¥ å…¥åº“' : 'ğŸ“¤ æ¶ˆè€—'} ${h.name} Ã—${h.qty}${h.unit}</span>
            <span class="history-date">${dateStr}</span>
          </div>
        `;
      }).join('');
    }

    function renderShopping() {
      const list = document.getElementById('shoppingList');
      
      if (shoppingList.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="emoji">âœ…</div><p>åº“å­˜å……è¶³ï¼Œæ— éœ€è¡¥è´§</p></div>';
        return;
      }

      list.innerHTML = shoppingList.map((item, index) => `
        <div class="shopping-item">
          <div class="shopping-check" onclick="toggleShopping(${index})"></div>
          <span class="shopping-text">${item}</span>
          <button class="qty-btn" onclick="removeShopping(${index})" style="color: var(--muted);">Ã—</button>
        </div>
      `).join('');
    }

    function renderSuggestion() {
      const available = inventory.map(i => i.name.toLowerCase());
      
      // æ˜¾ç¤ºç°æœ‰ä¸»è¦é£Ÿæ
      const mainIngredients = inventory.filter(i => ['meat', 'fresh', 'dairy'].includes(i.category)).slice(0, 8);
      document.getElementById('availableIngredients').innerHTML = mainIngredients.map(i => `
        <div class="item" style="padding: 8px 12px;">
          <div class="item-icon" style="font-size: 20px; width: 30px;">${getItemIcon(i.name)}</div>
          <div class="item-info">
            <div class="item-name" style="font-size: 13px;">${i.name}</div>
          </div>
          <span style="font-size: 12px; color: var(--muted);">${i.qty}${i.unit}</span>
        </div>
      `).join('') || '<p style="color: var(--muted); font-size: 13px;">æš‚æ— é£Ÿæ</p>';

      generateSuggestion();
    }

    function generateSuggestion() {
      const available = inventory.map(i => i.name.toLowerCase());
      
      // æ‰¾åˆ°å¯ä»¥åšçš„èœ
      const possible = recipes.filter(r => {
        const matched = r.ingredients.filter(ing => 
          available.some(a => a.includes(ing.toLowerCase()) || ing.toLowerCase().includes(a))
        );
        return matched.length >= Math.ceil(r.ingredients.length * 0.6);
      });

      const card = document.getElementById('recipeCard');
      
      if (possible.length === 0) {
        card.innerHTML = `
          <div class="recipe-title">ğŸ¤” é£Ÿæä¸è¶³</div>
          <div class="recipe-ingredients">åº“å­˜é£Ÿæè¾ƒå°‘ï¼Œå»ºè®®å…ˆé‡‡è´­ä¸€äº›åŸºç¡€é£Ÿæ</div>
        `;
        return;
      }

      const recipe = possible[Math.floor(Math.random() * possible.length)];
      const needToBuy = recipe.need.filter(n => !available.some(a => a.includes(n.toLowerCase())));

      card.innerHTML = `
        <div class="recipe-title">ğŸ³ ${recipe.name}</div>
        <div class="recipe-ingredients">
          <strong>é£Ÿæï¼š</strong>${recipe.ingredients.join('ã€')}
          ${needToBuy.length > 0 ? `<br><span style="color: var(--warning);">å¯èƒ½éœ€è¦è¡¥ï¼š${needToBuy.join('ã€')}</span>` : ''}
        </div>
      `;
    }

    // ============================================
    // è¾…åŠ©å‡½æ•°
    // ============================================

    function getItemIcon(name) {
      const icons = {
        'é¸¡è›‹': 'ğŸ¥š', 'è›‹': 'ğŸ¥š',
        'ç‰›å¥¶': 'ğŸ¥›', 'é…¸å¥¶': 'ğŸ¥›',
        'è¥¿å…°èŠ±': 'ğŸ¥¦', 'è èœ': 'ğŸ¥¬', 'ç”Ÿèœ': 'ğŸ¥¬', 'é’èœ': 'ğŸ¥¬',
        'ç•ªèŒ„': 'ğŸ…', 'è¥¿çº¢æŸ¿': 'ğŸ…',
        'é»„ç“œ': 'ğŸ¥’',
        'èƒ¡èåœ': 'ğŸ¥•',
        'åœŸè±†': 'ğŸ¥”', 'ç´«è–¯': 'ğŸ ', 'å—ç“œ': 'ğŸƒ',
        'æ´‹è‘±': 'ğŸ§…', 'å¤§è’œ': 'ğŸ§„', 'å§œ': 'ğŸ«š',
        'é¸¡': 'ğŸ—', 'é¸¡èƒ¸': 'ğŸ—', 'é¸¡è…¿': 'ğŸ—',
        'ç‰›': 'ğŸ¥©', 'çŒª': 'ğŸ¥“', 'æ’éª¨': 'ğŸ–',
        'é±¼': 'ğŸŸ', 'ä¸‰æ–‡é±¼': 'ğŸŸ', 'é³•é±¼': 'ğŸŸ', 'è™¾': 'ğŸ¦',
        'ç±³': 'ğŸš', 'é¢': 'ğŸ', 'æ„é¢': 'ğŸ', 'é¢åŒ…': 'ğŸ',
        'ç‡•éº¦': 'ğŸ¥£',
        'é¦™è•‰': 'ğŸŒ', 'è‹¹æœ': 'ğŸ', 'æ©™': 'ğŸŠ', 'æŸ æª¬': 'ğŸ‹',
        'è“è“': 'ğŸ«', 'è‰è“': 'ğŸ“', 'ç‰›æ²¹æœ': 'ğŸ¥‘',
        'è±†è…': 'ğŸ§ˆ',
        'åšæœ': 'ğŸ¥œ', 'æ ¸æ¡ƒ': 'ğŸŒ°',
        'èœ‚èœœ': 'ğŸ¯',
        'ç›': 'ğŸ§‚', 'æ²¹': 'ğŸ«’', 'é…±æ²¹': 'ğŸ¶',
      };
      
      for (const [key, icon] of Object.entries(icons)) {
        if (name.includes(key)) return icon;
      }
      return 'ğŸ½ï¸';
    }

    function getDaysUntilExpiry(expiry) {
      if (!expiry) return null;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const exp = new Date(expiry);
      return Math.floor((exp - today) / (1000 * 60 * 60 * 24));
    }

    function getExpiryClass(expiry) {
      const days = getDaysUntilExpiry(expiry);
      if (days === null) return '';
      if (days < 0) return 'expired';
      if (days <= 3) return 'expiring-soon';
      return '';
    }

    function getExpiryText(expiry) {
      const days = getDaysUntilExpiry(expiry);
      if (days === null) return '';
      if (days < 0) return 'å·²è¿‡æœŸ';
      if (days === 0) return 'ä»Šå¤©è¿‡æœŸ';
      if (days === 1) return 'æ˜å¤©è¿‡æœŸ';
      if (days <= 3) return `${days}å¤©åè¿‡æœŸ`;
      return '';
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.background = type === 'warning' ? 'var(--warning)' : 'var(--success)';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function toggleShopping(index) {
      const el = event.target;
      el.classList.toggle('checked');
      el.parentElement.querySelector('.shopping-text').classList.toggle('checked');
    }

    function removeShopping(index) {
      shoppingList.splice(index, 1);
      saveData();
      renderShopping();
    }

    function clearShoppingList() {
      if (confirm('ç¡®å®šæ¸…ç©ºè´­ç‰©æ¸…å•ï¼Ÿ')) {
        shoppingList = [];
        saveData();
        renderShopping();
      }
    }

    function clearHistory() {
      if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°å½•ï¼Ÿ')) {
        history = [];
        saveData();
        renderHistory();
      }
    }

    function exportData() {
      const data = { inventory, history, shoppingList, exportedAt: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pantry-backup-${new Date().toISOString().slice(0,10)}.json`;
      a.click();
      showToast('å·²å¯¼å‡º');
    }

    function importDataClick() {
      document.getElementById('importFile').click();
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.inventory) inventory = data.inventory;
          if (data.history) history = data.history;
          if (data.shoppingList) shoppingList = data.shoppingList;
          saveData();
          renderAll();
          showToast('å¯¼å…¥æˆåŠŸ');
        } catch (err) {
          showToast('å¯¼å…¥å¤±è´¥', 'warning');
        }
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
