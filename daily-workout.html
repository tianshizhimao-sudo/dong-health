<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1a2e">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“…</text></svg>">
  <link rel="preconnect" href="https://www.youtube.com">
  <title>ğŸ“… ä»Šæ—¥è®­ç»ƒ</title>
  <style>
    :root {
      --bg: #1a1a2e;
      --card: #16213e;
      --accent: #2ECC85;
      --accent-light: #4edd9a;
      --accent-warm: #e94560;
      --text: #eaeaea;
      --muted: #a0a0a0;
      --success: #2ECC85;
      --warning: #ffd93d;
      --border: #0f3460;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      padding: 16px;
      padding-bottom: max(100px, env(safe-area-inset-bottom, 100px));
      -webkit-font-smoothing: antialiased;
    }
    .container { max-width: 500px; margin: 0 auto; }
    
    header {
      text-align: center;
      padding: 20px 0 30px;
    }
    .date-display {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }
    .day-type {
      display: inline-block;
      padding: 8px 20px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border-radius: 30px;
      font-size: 16px;
      font-weight: 600;
    }
    .day-type.rest {
      background: linear-gradient(135deg, #4ecca3, #2ecc71);
    }
    .day-type.cardio {
      background: linear-gradient(135deg, var(--warning), #f39c12);
      color: #1a1a2e;
    }
    
    .section {
      background: var(--card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid var(--border);
    }
    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 20px;
    }
    .schedule-day {
      text-align: center;
      padding: 10px 4px;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      font-size: 11px;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    .schedule-day.today {
      border-color: var(--accent);
      background: rgba(46, 204, 133, 0.15);
    }
    .schedule-day .day-name {
      color: var(--muted);
      margin-bottom: 4px;
    }
    .schedule-day .day-icon {
      font-size: 18px;
    }
    
    .workout-summary {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .summary-row:last-child {
      border-bottom: none;
    }
    .summary-label {
      color: var(--muted);
      font-size: 14px;
    }
    .summary-value {
      font-weight: 600;
      font-size: 14px;
    }
    
    .video-card {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.2s;
    }
    .video-card:hover {
      border-color: var(--accent);
    }
    .video-card a {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .video-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .video-icon {
      width: 48px;
      height: 48px;
      background: #FF0000;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .video-info {
      flex: 1;
    }
    .video-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .video-channel {
      font-size: 12px;
      color: var(--muted);
    }
    .video-duration {
      font-size: 12px;
      color: var(--success);
      margin-top: 8px;
    }
    
    .tip-box {
      background: linear-gradient(135deg, rgba(78,204,163,0.1), rgba(46,204,113,0.1));
      border: 1px solid rgba(78,204,163,0.3);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
    }
    .tip-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tip-text {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .btn {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .btn-primary {
      background: var(--accent);
      color: #1a1a2e;
      font-weight: 700;
    }
    .btn-primary:hover {
      background: var(--accent-light);
    }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-secondary:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .nav-back {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .nav-back:hover {
      color: var(--text);
    }

    .calendar-options {
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 16px;
    }
    .time-picker {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .time-picker label {
      font-size: 14px;
      color: var(--muted);
    }
    .time-input {
      padding: 10px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 16px;
    }
    .time-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .calendar-warning {
      font-size: 13px;
      color: var(--warning);
      background: rgba(255, 217, 61, 0.1);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      line-height: 1.5;
    }
    .calendar-warning .hint-text {
      color: var(--muted);
      font-size: 12px;
    }
    .calendar-buttons {
      display: flex;
      gap: 10px;
    }
    .cal-btn {
      flex: 1;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--card);
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .cal-btn:hover {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }
    .cal-btn.google:hover {
      border-color: #4285f4;
      background: rgba(66, 133, 244, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="nav-back">â† è¿”å›å¥èº«ä¸­å¿ƒ</a>
    
    <header>
      <p class="date-display" id="dateDisplay"></p>
      <h1>ğŸ“… ä»Šæ—¥è®­ç»ƒ</h1>
      <span class="day-type" id="dayType"></span>
    </header>

    <!-- å‘¨è®¡åˆ’æ¦‚è§ˆ -->
    <div class="section">
      <div class="section-title">ğŸ“† æœ¬å‘¨è®¡åˆ’</div>
      <div class="schedule-grid" id="scheduleGrid">
        <!-- JS ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ä»Šæ—¥è®­ç»ƒè¯¦æƒ… -->
    <div class="section" id="workoutSection">
      <div class="section-title" id="workoutTitle">ğŸ’ª è®­ç»ƒå†…å®¹</div>
      <div class="workout-summary" id="workoutSummary">
        <!-- JS ç”Ÿæˆ -->
      </div>
    </div>

    <!-- è§†é¢‘æ¨è -->
    <div class="section" id="videoSection">
      <div class="section-title">ğŸ“º æ¨èè§†é¢‘</div>
      <div id="videoList">
        <!-- JS ç”Ÿæˆ -->
      </div>
    </div>

    <!-- å°è´´å£« -->
    <div class="tip-box" id="tipBox">
      <div class="tip-title">ğŸ’¡ è®­ç»ƒæç¤º</div>
      <p class="tip-text" id="tipText"></p>
    </div>

    <!-- æ—¥å†é›†æˆ -->
    <div class="section" id="calendarSection">
      <div class="section-title">ğŸ“… æ·»åŠ åˆ°æ—¥å†</div>
      <div class="calendar-options">
        <div class="time-picker">
          <label>é€‰æ‹©è®­ç»ƒæ—¶é—´</label>
          <input type="time" id="workoutTime" value="18:00" class="time-input">
        </div>
        <div class="calendar-warning">
          âš ï¸ å»ºè®®é¿å¼€ä¼šè®®å‰å1å°æ—¶
          <br><span class="hint-text">ğŸ’¡ è·Ÿ Oney è¯´"æ£€æŸ¥æˆ‘æ˜å¤©çš„æ—¥ç¨‹"ç¡®è®¤æ— å†²çª</span>
        </div>
        <div class="calendar-buttons">
          <button class="cal-btn" onclick="downloadICS()">
            ğŸ Apple Calendar
          </button>
          <button class="cal-btn google" onclick="addToGoogleCalendar()">
            ğŸ“† Google Calendar
          </button>
        </div>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-buttons">
      <a href="fitness-tracker.html" class="btn btn-primary">âœ… å¼€å§‹æ‰“å¡</a>
      <a href="exercise-library.html" class="btn btn-secondary">ğŸ“š åŠ¨ä½œåº“</a>
    </div>
  </div>

  <script>
    // è®­ç»ƒè®¡åˆ’æ•°æ®
    const weekPlan = {
      1: { // å‘¨ä¸€
        type: 'æ ¸å¿ƒ+æœ‰æ°§',
        icon: 'ğŸ”¥',
        class: '',
        duration: '90åˆ†é’Ÿ',
        focus: ['æ ¸å¿ƒåŠ›é‡', 'Cableè®­ç»ƒ', 'HIITæœ‰æ°§'],
        exercises: ['Woodchop', 'Pallof Press', 'æ‚¬å‚ä¸¾è…¿', 'åˆ’èˆ¹æœºHIIT'],
        videos: [
          { title: '10 Min Core Workout', channel: 'Chris Heria', duration: '10åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=tVdgwbKeclA' },
          { title: 'Cable Core Exercises', channel: 'ATHLEAN-X', duration: '8åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=6u0RxFH9p78' },
          { title: '20 Min HIIT Workout', channel: 'THENX', duration: '20åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=ml6cT4AZdqI' }
        ],
        tip: 'æ ¸å¿ƒè®­ç»ƒå‰ç¡®ä¿çƒ­èº«å……åˆ†ï¼Œæ³¨æ„å‘¼å¸èŠ‚å¥ã€‚HIITéƒ¨åˆ†æ ¹æ®ä½“èƒ½è°ƒæ•´å¼ºåº¦ï¼Œä¿æŒå¿ƒç‡åœ¨ç›®æ ‡åŒºé—´ã€‚'
      },
      2: { // å‘¨äºŒ
        type: 'ä¸‹è‚¢æ—¥ / PT',
        icon: 'ğŸ¦µ',
        class: '',
        duration: '90åˆ†é’Ÿ',
        focus: ['è‚¡å››å¤´è‚Œ', 'è‡€éƒ¨', 'è…˜ç»³è‚Œ'],
        exercises: ['æ é“ƒæ·±è¹²', 'ç½—é©¬å°¼äºšç¡¬æ‹‰', 'ä¿åŠ åˆ©äºšåˆ†è…¿è¹²', 'è…¿ä¸¾'],
        videos: [
          { title: 'Perfect Squat Form', channel: 'Jeff Nippard', duration: '12åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=bEv6CCg2BC8' },
          { title: 'Complete Leg Workout', channel: 'Chris Heria', duration: '30åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=ixkQaZXVQjs' },
          { title: 'Romanian Deadlift Guide', channel: 'ATHLEAN-X', duration: '8åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=JCXUYuzwNrM' }
        ],
        tip: 'æ·±è¹²æ³¨æ„è†ç›–ä¸è¦å†…æ‰£ï¼Œä¿æŒæ ¸å¿ƒæ”¶ç´§ã€‚å¦‚æœæœ‰PTè¯¾ï¼Œå¬ä»æ•™ç»ƒæŒ‡å¯¼è°ƒæ•´é‡é‡ã€‚'
      },
      3: { // å‘¨ä¸‰
        type: 'PT Andy',
        icon: 'ğŸ¯',
        class: '',
        duration: '60åˆ†é’Ÿ',
        focus: ['ç§æ•™è¯¾ç¨‹', 'Bligh St'],
        exercises: ['æ ¹æ®PTå®‰æ’'],
        videos: [
          { title: 'Pre-Workout Mobility', channel: 'Tom Merrick', duration: '10åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=SsT_go-oCcQ' }
        ],
        tip: 'æ—©ä¸Š8:30 PT Andy @ Bligh Stã€‚æå‰å‡†å¤‡å¥½è®­ç»ƒæœå’Œæ°´ï¼Œè¯¾å‰å¯ä»¥åšäº›è½»åº¦çƒ­èº«ã€‚ï¼ˆä¸´æ—¶è°ƒæ•´è‡³~4æœˆï¼ŒOliåº·å¤åæ¢å¤å‘¨å››ï¼‰'
      },
      4: { // å‘¨å››
        type: 'çŸ­è·‘',
        icon: 'ğŸƒ',
        class: 'cardio',
        duration: '30-45åˆ†é’Ÿ',
        focus: ['æœ‰æ°§è€åŠ›', 'å¿ƒè‚ºåŠŸèƒ½'],
        exercises: ['3-5å…¬é‡Œè·‘æ­¥'],
        videos: [
          { title: 'Running Form Tips', channel: 'The Run Experience', duration: '10åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=brFHyOtTwH4' },
          { title: 'How to Run Properly', channel: 'Global Triathlon Network', duration: '8åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=wRkeBVMQSgg' }
        ],
        tip: 'è·‘å‰åŠ¨æ€çƒ­èº«ï¼Œè·‘åé™æ€æ‹‰ä¼¸ã€‚é…é€Ÿæ ¹æ®èº«ä½“çŠ¶æ€è°ƒæ•´ï¼Œä¸å¿…æ¯æ¬¡éƒ½è¿½æ±‚é€Ÿåº¦ã€‚'
      },
      5: { // å‘¨äº”
        type: 'ä¸‹è‚¢æ—¥ / ä¼‘æ¯',
        icon: 'ğŸ¦µ',
        class: '',
        duration: '90åˆ†é’Ÿ',
        focus: ['è‚¡å››å¤´è‚Œ', 'è‡€éƒ¨', 'å°è…¿'],
        exercises: ['è…¿ä¸¾', 'è…¿å±ˆä¼¸', 'è…¿å¼¯ä¸¾', 'æè¸µ'],
        videos: [
          { title: 'Leg Press Mistakes', channel: 'ATHLEAN-X', duration: '8åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=IZxyjW7MPJQ' },
          { title: 'Calf Training Science', channel: 'Jeff Nippard', duration: '15åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=BvLiRfb6WLA' }
        ],
        tip: 'å¦‚æœæœ¬å‘¨æœ‰PTè¯¾ï¼Œä»Šå¤©å¯ä»¥ä¼‘æ¯æˆ–åšè½»åº¦æœ‰æ°§ã€‚æ²¡æœ‰PTçš„å‘¨ï¼Œä»Šå¤©ç»ƒä¸‹è‚¢ã€‚'
      },
      6: { // å‘¨å…­
        type: 'ä¸Šè‚¢æ—¥',
        icon: 'ğŸ’ª',
        class: '',
        duration: '90åˆ†é’Ÿ',
        focus: ['èƒ¸', 'èƒŒ', 'è‚©', 'æ‰‹è‡‚'],
        exercises: ['æ é“ƒå§æ¨', 'å¼•ä½“å‘ä¸Š', 'æ é“ƒåˆ’èˆ¹', 'è‚©æ¨', 'å¼¯ä¸¾'],
        videos: [
          { title: 'Push Day Workout', channel: 'Chris Heria', duration: '30åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=BkS1-El_WlE' },
          { title: 'Pull Day Workout', channel: 'Chris Heria', duration: '30åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=vwMPfccvQXc' },
          { title: 'Perfect Push Up Form', channel: 'ATHLEAN-X', duration: '10åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=IODxDxX7oi4' }
        ],
        tip: 'ä¸Šè‚¢æ—¥åŠ¨ä½œå¤šï¼Œæ³¨æ„æ§åˆ¶ç»„é—´ä¼‘æ¯æ—¶é—´ã€‚å§æ¨å’Œåˆ’èˆ¹æ˜¯é‡ç‚¹ï¼Œç¡®ä¿åŠ¨ä½œæ ‡å‡†å†åŠ é‡é‡ã€‚'
      },
      0: { // å‘¨æ—¥
        type: 'ä¼‘æ¯æ—¥',
        icon: 'ğŸ˜´',
        class: 'rest',
        duration: '15-20åˆ†é’Ÿ',
        focus: ['æ¢å¤', 'æ‹‰ä¼¸', 'æ”¾æ¾'],
        exercises: ['æ³¡æ²«è½´æ”¾æ¾', 'å…¨èº«æ‹‰ä¼¸', 'è½»åº¦ç‘œä¼½'],
        videos: [
          { title: '15 Min Full Body Stretch', channel: 'Tom Merrick', duration: '15åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=g_tea8ZNk5A' },
          { title: 'Yoga for Athletes', channel: 'Yoga With Adriene', duration: '20åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=COp7BR_Dvps' },
          { title: 'Foam Rolling Routine', channel: 'ATHLEAN-X', duration: '12åˆ†é’Ÿ', url: 'https://www.youtube.com/watch?v=SxQtcbqHSMA' }
        ],
        tip: 'ä¼‘æ¯æ—¥åŒæ ·é‡è¦ï¼å……åˆ†çš„æ¢å¤æ‰èƒ½è®©ä¸‹å‘¨è®­ç»ƒæ›´æœ‰æ•ˆã€‚å¯ä»¥åšäº›è½»åº¦æ´»åŠ¨ä¿ƒè¿›è¡€æ¶²å¾ªç¯ã€‚'
      }
    };

    const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
    const dayIcons = ['ğŸ˜´', 'ğŸ”¥', 'ğŸ¦µ', 'ğŸ¯', 'ğŸƒ', 'ğŸ¦µ', 'ğŸ’ª'];

    // åˆå§‹åŒ–
    function init() {
      const now = new Date();
      const today = now.getDay();
      const plan = weekPlan[today];

      // æ˜¾ç¤ºæ—¥æœŸ
      const dateStr = now.toLocaleDateString('zh-CN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
      });
      document.getElementById('dateDisplay').textContent = dateStr;

      // æ˜¾ç¤ºè®­ç»ƒç±»å‹
      const dayTypeEl = document.getElementById('dayType');
      dayTypeEl.textContent = `${plan.icon} ${plan.type}`;
      if (plan.class) dayTypeEl.classList.add(plan.class);

      // ç”Ÿæˆå‘¨è®¡åˆ’
      const scheduleGrid = document.getElementById('scheduleGrid');
      scheduleGrid.innerHTML = '';
      for (let i = 1; i <= 7; i++) {
        const dayIndex = i % 7; // å‘¨ä¸€åˆ°å‘¨æ—¥
        const isToday = dayIndex === today;
        scheduleGrid.innerHTML += `
          <div class="schedule-day ${isToday ? 'today' : ''}">
            <div class="day-name">${dayNames[dayIndex]}</div>
            <div class="day-icon">${dayIcons[dayIndex]}</div>
          </div>
        `;
      }

      // ç”Ÿæˆè®­ç»ƒæ‘˜è¦
      document.getElementById('workoutTitle').innerHTML = `${plan.icon} ${plan.type}`;
      const summaryHtml = `
        <div class="summary-row">
          <span class="summary-label">æ—¶é•¿</span>
          <span class="summary-value">${plan.duration}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">é‡ç‚¹</span>
          <span class="summary-value">${plan.focus.join(' Â· ')}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">åŠ¨ä½œ</span>
          <span class="summary-value">${plan.exercises.join(' Â· ')}</span>
        </div>
      `;
      document.getElementById('workoutSummary').innerHTML = summaryHtml;

      // ç”Ÿæˆè§†é¢‘åˆ—è¡¨
      const videoList = document.getElementById('videoList');
      videoList.innerHTML = '';
      plan.videos.forEach(video => {
        videoList.innerHTML += `
          <div class="video-card">
            <a href="${video.url}" target="_blank">
              <div class="video-header">
                <div class="video-icon">â–¶ï¸</div>
                <div class="video-info">
                  <div class="video-title">${video.title}</div>
                  <div class="video-channel">${video.channel}</div>
                </div>
              </div>
              <div class="video-duration">â±ï¸ ${video.duration}</div>
            </a>
          </div>
        `;
      });

      // æ˜¾ç¤ºæç¤º
      document.getElementById('tipText').textContent = plan.tip;
    }

    init();

    // Calendar integration
    function getWorkoutDateTime() {
      const time = document.getElementById('workoutTime').value;
      const [hours, minutes] = time.split(':');
      const date = new Date();
      date.setHours(parseInt(hours), parseInt(minutes), 0, 0);
      return date;
    }

    function formatICSDate(date) {
      return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    }

    function downloadICS() {
      const today = new Date().getDay();
      const plan = weekPlan[today];
      const startTime = getWorkoutDateTime();
      const endTime = new Date(startTime);

      // Parse duration (e.g., "90åˆ†é’Ÿ" -> 90)
      const durationMatch = plan.duration.match(/(\d+)/);
      const durationMinutes = durationMatch ? parseInt(durationMatch[1]) : 60;
      endTime.setMinutes(endTime.getMinutes() + durationMinutes);

      const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Dong Fitness//EN
BEGIN:VEVENT
UID:${Date.now()}@dong-fitness
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${formatICSDate(startTime)}
DTEND:${formatICSDate(endTime)}
SUMMARY:${plan.icon} ${plan.type}
DESCRIPTION:è®­ç»ƒå†…å®¹ï¼š${plan.exercises.join('ã€')}\\n\\nè®­ç»ƒé‡ç‚¹ï¼š${plan.focus.join('ã€')}\\n\\nğŸ’¡ ${plan.tip}
LOCATION:Virgin Active Gym
BEGIN:VALARM
TRIGGER:-PT30M
ACTION:DISPLAY
DESCRIPTION:å¥èº«æ—¶é—´åˆ°ï¼å‡†å¤‡å»å¥èº«æˆ¿
END:VALARM
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dong-workout-${new Date().toISOString().split('T')[0]}.ics`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function addToGoogleCalendar() {
      const today = new Date().getDay();
      const plan = weekPlan[today];
      const startTime = getWorkoutDateTime();
      const endTime = new Date(startTime);

      const durationMatch = plan.duration.match(/(\d+)/);
      const durationMinutes = durationMatch ? parseInt(durationMatch[1]) : 60;
      endTime.setMinutes(endTime.getMinutes() + durationMinutes);

      // Format for Google Calendar URL
      const formatGoogleDate = (d) => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

      const title = encodeURIComponent(`${plan.icon} ${plan.type}`);
      const details = encodeURIComponent(`è®­ç»ƒå†…å®¹ï¼š${plan.exercises.join('ã€')}\n\nè®­ç»ƒé‡ç‚¹ï¼š${plan.focus.join('ã€')}\n\nğŸ’¡ ${plan.tip}`);
      const location = encodeURIComponent('Virgin Active Gym');
      const dates = `${formatGoogleDate(startTime)}/${formatGoogleDate(endTime)}`;

      const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${dates}&details=${details}&location=${location}`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
